{#   Logged In - Org Info   #}

{% extends "_layouts/_base" %}
{% import '_macros/global' as global %}
{% import '_macros/forms' as form %}

{% requireLogin %}
{% if not currentUser.isInGroup('memberAdmin') %}
    {% redirect '/account/profile' %}
{% endif %}


{% set organization = craft.entries().id(currentUser.organizationId).one() %}
{% if not organization %}
    {% redirect '/account/profile' %}
{% endif %}
{% set orgUsers = craft.users({
   search: 'organizationId::' ~ currentUser.organizationId,
   status: ['active', 'suspended'],
   order: 'lastname, firstname'
}) %}

{% block content %}

   {#   Page Header   #}
   {% include '_components/static/page-header'
      with {
         'type': 'border',
         'heading': 'Manage Members',
         'link_url': '../account/members-invite',
         'link_text': 'Invite Members'
      }
   %}
   
   <div class="form-flow  |  container">
      <h2>Active Members</h2>

      <div class="flex flex-wrap" style="max-width: 50rem">
         {% for user in orgUsers %}
            <div class="sm:flex sm:items-center sm:justify-between  |  w-full  |  mb-6 pr-4 pb-6  |  border-b border-grey-lighter memberListItem {{ (user.status == 'active') ? 'activeUser' : 'suspendedUser' }}">
               <div class="mb-3 sm:mb-0">
                  <h3 class="font-normal leading-tight text-16  |  mb-1">{{ user.firstName }} {{ user.lastName }}</h3>
                  <p class="leading-tight">{{ user.email }}</p>
                  <p>
                  {% if user.isInGroup('memberAdmin') %}
                  Admin
                  {% else %}
				  Member
				  {% endif %}
                  </p>
               </div>
               
               {% if currentUser.id != user.id %}
			   
			   
			   {% if user.status == 'active' %}
               		<button class="btn --deactivate  |  sm:ml-4  |  js--deactivate-trigger" type="button" data-id="{{ user.id }}">Deactivate Account</button>
{# 				    <input class="btn --deactivate  |  sm:ml-4  |  js--deactivate-trigger" type="submit" value="Deactivate Account" data-id="{{ user.id }}"> #}
				{% else %}
					<form method="post" id="suspendUser">
				    {{ getCsrfInput() }}
				    <input type="hidden" name="userId" value="{{ user.id }}">
				    <input type="hidden" name="action" value="users/unsuspend-user">
				    <input class="btn --reactivate --deactivate  |  sm:ml-4" type="submit" value="Reactivate Account">
				    </form>
				{% endif %}
				
				
				
               
               {% endif %}
            </div>
         {% endfor %}
      </div>
   </div>


   {#   Deactivate Module   #}
   <div class="modal__container  |  js--deactivate-modal">
      {#   Overlay   #}
      <div class="modal__overlay"></div>

      {#   Modal   #}
      <div class="modal">
         {#   Header   #}
         <div class="modal__header">
            <h1 class="modal__title">Deactivate account?</h1>

            <button class="modal__close-btn  |  js--modal__close-btn">
               {{ global.utilityIcon('close') }}
            </button>
         </div>

         {#   Copy   #}
         <div class="modal__copy">
            <p>Are you sure you want to deactive this account? Once deactivated, this member will no longer be able to sign in to TACWA.org</p>
         </div>

         {#   Action   #}
         <div class="modal__action">
            {#   Cancel   #}
            <button class="btn --simple  |  mr-4  |  js--modal__cancel-btn" type="button">Cancel</button>

            {#   Deactivate   #}
            <form method="post" id="suspendUser">
			    {{ getCsrfInput() }}
			    <input type="hidden" id="userId" name="userId" value="">
			    <input type="hidden" name="action" value="users/suspend-user">
				<input type="submit" value="Deactivate" class="btn --primary --caution">
			</form>
         </div>
      </div>
   </div>


{% endblock %}


{% do view.registerJsFile('/assets/js/deactivate-member-modal.js') %}